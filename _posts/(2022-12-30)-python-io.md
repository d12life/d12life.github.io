---
layout: post
author: d12life
title: Bài 10 - Thao tác file trong Python
---
`os` có thể coi là một module bao gói các lệnh gọi POSIX hoặc mô phỏng chúng trên một số nền tảng mà không có POSIX. Bạn sẽ thấy các hàm gần như được đặt tên giống hệt như trong C và các ngôn ngữ khác cũng như cách thực hiện tương tự. Có thể dễ dàng nhận ra các hằng số như os.R_OK, os.WNOHANG, ... được đặt tên chính xác theo C/POSIX.

`shutil` và `glob` chứa các hàm đặc trưng Python, cho phép người dùng thực hiện nhiều thao tác phức tạp hơn so với os. Các hàm của `shutil` và  thường gọi lại nhiều hàm của os còn `glob` cho phép thao tác trên file với regex pattern.

# 1. Module os
Module là một module tích hợp sẵn với Python, module này cho phép chúng ta thao tác với tệp  và thư mục. Để sử dụng module os chúng ta sẽ sử dụng câu lệnh
```
import os
```

Có khá nhiều các phương thức trong module os, tuy nhiên trong thực tế chúng ta không cần nhớ hết tất cả các hàm, phương thức này. Ở đây chúng ta sẽ chỉ giới thiệu một vài phương thức chính.

## os.getcwd():
Hàm **getcwd()** trả về thư mục làm việc hiện tại của một tiến trình.

## os.listdir()
Phương thức này sẽ liệt kê tất cả các tệp, thư mục của đường dẫn được truyền vào

## os.walk()
Phương thức này sẽ duyệt qua hệ thống cây thư mục và trả về thông tin cây thư mục được bắt đầu từ đường dẫn được truyền vào bằng cách di di chuyển trên cây thư mục từ trên xuống hoặc từ dưới lên (dựa vào tham số topdown). Phương thức trả về một bộ gồm 3 thông tin sau (root, dirs, files).
- **root:** Chỉ: in ra các thư mục từ những gì bạn đã chỉ định.
- **dirs:** in ra các thư mục con từ root.
- **files:** in ra tất cả các tập tin từ thư mục gốc và thư mục.

Mặc định tham số topdown = True (chúng ta có thể bỏ qua hoặc gán tường minh topdown=True). Để duyệt cây thư mục từ dưới lên chúng ta sẽ set tham số topdown=False.

Ví dụ
```
import os

for (root,dirs,files) in os.walk('F:\\code', topdown=True):
    print(root) # Thư mục cần duyệt
    print(dirs) # list các thư mục con
    print(files) # list các file
    print('--------------------------------')
```
Kết quả
```
F:\code 
['test'] 
['example1.py', 'example2.txt'] 
--------------------------------
F:\code\test
[]
['example3.txt']
--------------------------------
```

## os.chdir()
Phương thức để thay đổi thư mục làm việc hiện tại

## Tạo thư mục bằng os.mkdir()
Phương thức os.mkdir() cho phép chúng ta tạo thư mục/tệp ở đường dẫn được truyền

## os.rename()
Phương thức cho phép đổi tên file/thư mục.

## os.remove("my_file_path")
Xóa file ở đường dẫn được truyền vào.

Ngoài os.remove chúng ta cũng có thể sử dụng:
- **os.rmdir():** removes an empty directory.
- **shutil.rmtree():** deletes a directory and all its contents.
- **pathlib.Path.unlink():** removes the file or symbolic link.
- **pathlib.Path.rmdir():** removes the empty directory.

## os.path.join()
Module os.path chứa khá nhiều phương thức hữu ích cho các thao tác phổ biến để quản lý thư mục và file. Bạn có thể sử dụng nó để tìm thông tin về tên thư mục, các phần của tên thư mục, kiểm tra xem một tập tin hoặc thư mục tồn tại hay không ...

os.path.join() cho phép bạn có thể nối các đường dẫn với nhau theo để tạo nên 1 đường dẫn hoàn chỉnh và phù hợp nhất. Thay vì phải đau đầu sửa code để tạo đường dẫn theo từng hệ điều hành khác nhau, phương thức này sẽ giúp bạn tạo ra đường dẫn phù hợp nhất.

Lấy ví dụ, khi bạn làm việc hoặc chạy chương trình trên môi trường Unix hoặc MacOS, đường dẫn do os.path.join() tạo ra sẽ có dạng "duong_dan/den/file_hoac_folder", trong khi đó trên Windows thì đường dẫn sẽ là "duong_dan\den\file_hoac_folder". Hoặc khi bạn ghép nối 2 string: "duong_dan/" và "den/file_hoac_folder" thì kết quả sẽ là: "duong_dan//den/file_hoac_folder", trong khi sử dụng os.path.join() ta sẽ được "duong_dan/den/file_hoac_folder" một cách nhanh chóng.

# 2. Module shutil và glob
Như đã nói ở trên, `shutil` và `glob` chứa các hàm đặc trưng Python, cho phép người dùng thực hiện nhiều thao tác phức tạp hơn so với os. Các hàm của `shutil` và  thường gọi lại nhiều hàm của os còn `glob` cho phép thao tác trên file với regex pattern.

## shutil.copy2("source_file", "destination")
Di chuyển file từ thư mục này sang thư mục khác.

Tại sao lại là copy2? Thực ra chúng ta có nhiều hàm copy khác với những mục đích khác nhau, copy2 cho phép copy cả các thông tin về metadata, permissions. Ngoài ra, đối số destination trong copy2 có thể là đường dẫn tới thư mục.
```
import shutil
shutil.copy2('/src/dir/file.ext', '/dst/dir/newname.ext')       # complete target filename given
shutil.copy2('/src/file.ext', '/dst/dir')                       # target filename is /dst/dir/file.ext
```

Bảng dưới đây cho biết chi tiết hơn về các hàm copy khác nhau hỗ trợ bởi shutil:
![image](/assets/images/lession_10/Screenshot%202023-01-05%20150919.png)

## shutil.move("source_file", "destination")
Di chuyển file từ thư mục này sang thư mục khác. Chúng ta cũng có thể dùng `os.rename` để có kết quả tương tự.
```
import os
import shutil

os.rename("path/to/current/file.foo", "path/to/new/destination/for/file.foo")
shutil.move("path/to/current/file.foo", "path/to/new/destination/for/file.foo")
```

Lưu ý rằng trong cả hai trường hợp, thư mục chứa file mới phải tồn tại sẵn, ngoài ra thì trên môi trường Windows, trong cùng một thư mục thì không được có file và thư mục con trùng tên nhau. Bạn cũng phải chú ý tên của file (file.foo) trong cả đối số nguồn và đích nếu không tập tin sẽ bị đổi tên 
trong khi di chuyển.

Thường thì `shutil.move` sẽ gọi lại `os.rename` trong hầu hết các trường hợp, tuy nhiên nếu đường dẫn đích nằm trên một đĩa khác với nguồn thì hàm này sẽ không sử dụng `os.rename` mà sẽ sao chép file trước bằng `shutil.copy2` sau đó xóa file nguồn. Nguyên nhân là os.rename sẽ chỉ làm việc khi đường dẫn nguồn và đường dẫn đích nằm trên cùng một ổ đĩa.


# 3. Tham khảo
1. [https://blog.luyencode.net/module-os-trong-python/](https://blog.luyencode.net/module-os-trong-python/)
2. [https://cuccode.com/python_os_and_shutil.html](https://cuccode.com/python_os_and_shutil.html)
3. https://boxhoidap.com/glob-trong-python